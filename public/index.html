<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Media File Manager - Upload and manage media files with metadata"
    />
    <script>
      // Comprehensive browser compatibility polyfills
      if (!Array.prototype.includes) {
        Array.prototype.includes = function(searchElement) {
          return this.indexOf(searchElement) !== -1;
        };
      }
      if (!Object.assign) {
        Object.assign = function(target) {
          for (var i = 1; i < arguments.length; i++) {
            var source = arguments[i];
            for (var key in source) {
              if (Object.prototype.hasOwnProperty.call(source, key)) {
                target[key] = source[key];
              }
            }
          }
          return target;
        };
      }
      if (!String.prototype.includes) {
        String.prototype.includes = function(search, start) {
          if (typeof start !== 'number') {
            start = 0;
          }
          if (start + search.length > this.length) {
            return false;
          } else {
            return this.indexOf(search, start) !== -1;
          }
        };
      }
      // Add fetch polyfill for older browsers
      if (!window.fetch) {
        window.fetch = function(url, options) {
          return new Promise(function(resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.open(options && options.method || 'GET', url);
            xhr.onload = function() {
              resolve({
                ok: xhr.status >= 200 && xhr.status < 300,
                status: xhr.status,
                text: function() { return Promise.resolve(xhr.responseText); },
                json: function() { return Promise.resolve(JSON.parse(xhr.responseText)); }
              });
            };
            xhr.onerror = reject;
            if (options && options.body) {
              xhr.send(options.body);
            } else {
              xhr.send();
            }
          });
        };
      }
      if (!window.Promise) {
        window.Promise = function(executor) {
          var self = this;
          self.state = 'pending';
          self.value = undefined;
          self.handlers = [];
          
          function resolve(result) {
            if (self.state === 'pending') {
              self.state = 'fulfilled';
              self.value = result;
              self.handlers.forEach(handle);
              self.handlers = null;
            }
          }
          
          function reject(error) {
            if (self.state === 'pending') {
              self.state = 'rejected';
              self.value = error;
              self.handlers.forEach(handle);
              self.handlers = null;
            }
          }
          
          function handle(handler) {
            if (self.state === 'pending') {
              self.handlers.push(handler);
            } else {
              if (self.state === 'fulfilled' && typeof handler.onFulfilled === 'function') {
                handler.onFulfilled(self.value);
              }
              if (self.state === 'rejected' && typeof handler.onRejected === 'function') {
                handler.onRejected(self.value);
              }
            }
          }
          
          this.then = function(onFulfilled, onRejected) {
            return new Promise(function(resolve, reject) {
              handle({
                onFulfilled: function(result) {
                  try {
                    resolve(onFulfilled ? onFulfilled(result) : result);
                  } catch (ex) {
                    reject(ex);
                  }
                },
                onRejected: function(error) {
                  try {
                    resolve(onRejected ? onRejected(error) : error);
                  } catch (ex) {
                    reject(ex);
                  }
                }
              });
            });
          };
          
          try {
            executor(resolve, reject);
          } catch (ex) {
            reject(ex);
          }
        };
      }
      
      // Enhanced JavaScript bundle loading verification with multiple retry attempts
      var reactLoadAttempts = 0;
      var maxReactLoadAttempts = 5;
      
      function checkReactLibraries() {
        reactLoadAttempts++;
        console.log('Checking React libraries (attempt ' + reactLoadAttempts + '/' + maxReactLoadAttempts + ')...');
        
        if (window.React && window.ReactDOM) {
          console.log('✅ React libraries loaded successfully');
          return true;
        } else {
          console.warn('⚠️ React libraries not yet available:', {
            React: !!window.React,
            ReactDOM: !!window.ReactDOM
          });
          
          if (reactLoadAttempts < maxReactLoadAttempts) {
            setTimeout(checkReactLibraries, 1000);
            return false;
          } else {
            console.error('❌ React libraries failed to load after ' + maxReactLoadAttempts + ' attempts');
            showCompatibilityError('React libraries failed to load after multiple attempts');
            return false;
          }
        }
      }
      
      window.addEventListener('load', function() {
        console.log('Page loaded, starting React library verification...');
        
        // Test for modern JavaScript support
        var supportsModernJS = true;
        try {
          eval('() => {}');
          eval('const test = 1;');
          eval('`template`');
          eval('var {a} = {a: 1};');
        } catch (e) {
          console.warn('Modern JavaScript features not supported:', e);
          supportsModernJS = false;
        }
        
        // Start checking React libraries immediately
        setTimeout(function() {
          if (!checkReactLibraries()) {
            return; // checkReactLibraries will handle retries
          }
          
          if (!supportsModernJS) {
            console.error('Browser does not support modern JavaScript features required by the application');
            showCompatibilityError('Browser compatibility issue detected');
          }
        }, 500);
      });
      
      function showCompatibilityError(reason) {
        document.getElementById('root').innerHTML = 
          '<div style="padding: 20px; color: white; background: #1a1a1a; font-family: Arial, sans-serif; min-height: 100vh;">' +
          '<h2>Media File Manager - Compatibility Issue</h2>' +
          '<p><strong>Issue:</strong> ' + reason + '</p>' +
          '<p>This application requires a modern web browser. Please try:</p>' +
          '<ul>' +
          '<li><strong>Update your browser</strong> to the latest version</li>' +
          '<li><strong>Use a modern browser:</strong> Chrome 60+, Firefox 55+, Safari 12+, Edge 79+</li>' +
          '<li><strong>Disable browser extensions</strong> that might block JavaScript</li>' +
          '<li><strong>Check your internet connection</strong> and try refreshing</li>' +
          '</ul>' +
          '<div style="margin-top: 20px; padding: 15px; background: #2d2d2d; border-radius: 8px;">' +
          '<h3>Browser Information:</h3>' +
          '<p><strong>User Agent:</strong> ' + navigator.userAgent + '</p>' +
          '<p><strong>JavaScript Enabled:</strong> Yes</p>' +
          '<p><strong>Modern JS Support:</strong> ' + (typeof eval !== 'undefined' ? 'Partial' : 'No') + '</p>' +
          '</div>' +
          '<button onclick="window.location.reload()" style="margin-top: 20px; padding: 12px 24px; background: #4f46e5; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">Try Again</button>' +
          '</div>';
      }
      
      // Add error event listener for script loading failures
      window.addEventListener('error', function(e) {
        if (e.target && e.target.tagName === 'SCRIPT') {
          console.error('Script loading failed:', e.target.src);
          // Redirect to fallback page if critical scripts fail to load
          setTimeout(function() {
            if (!window.React || !window.ReactDOM) {
              console.error('Critical scripts failed, redirecting to fallback page');
              window.location.href = '/fallback.html';
            }
          }, 3000);
        }
      });
      
      // Global error handler for unhandled JavaScript errors
      window.addEventListener('unhandledrejection', function(e) {
        console.error('Unhandled promise rejection:', e.reason);
      });
      
      // Detect if the browser supports modern JavaScript features
      window.browserSupportsModernJS = function() {
        try {
          eval('const test = () => {};');
          eval('let {a} = {a: 1};');
          eval('`template literal`');
          return true;
        } catch (e) {
          return false;
        }
      };
    </script>
    <title>Media File Manager</title>
    
    <!-- Enhanced React library loading with CDN fallbacks -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Fallback CDN for React libraries -->
    <script>
      // Verify React libraries loaded from primary CDN
      if (!window.React || !window.ReactDOM) {
        console.warn('Primary React CDN failed, trying fallback CDN...');
        
        // Fallback to different CDN
        var reactScript = document.createElement('script');
        reactScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js';
        reactScript.crossOrigin = 'anonymous';
        document.head.appendChild(reactScript);
        
        var reactDOMScript = document.createElement('script');
        reactDOMScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js';
        reactDOMScript.crossOrigin = 'anonymous';
        document.head.appendChild(reactDOMScript);
        
        // If fallback also fails, try jsdelivr CDN
        setTimeout(function() {
          if (!window.React || !window.ReactDOM) {
            console.warn('Fallback CDN also failed, trying jsdelivr CDN...');
            
            var reactScript2 = document.createElement('script');
            reactScript2.src = 'https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js';
            reactScript2.crossOrigin = 'anonymous';
            document.head.appendChild(reactScript2);
            
            var reactDOMScript2 = document.createElement('script');
            reactDOMScript2.src = 'https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js';
            reactDOMScript2.crossOrigin = 'anonymous';
            document.head.appendChild(reactDOMScript2);
          }
        }, 2000);
      }
    </script>
  </head>
  <body>
    <noscript>
      <div style="padding: 20px; color: red; font-family: Arial, sans-serif; background: #1a1a1a; min-height: 100vh;">
        <h2>JavaScript Required</h2>
        <p>You need to enable JavaScript to run this app.</p>
      </div>
    </noscript>
    <div id="root">
      <div id="loading-indicator" style="padding: 20px; color: white; font-family: Arial, sans-serif; background: #1a1a1a; min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="text-align: center;">
          <div style="border: 4px solid #333; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
          <h2>Loading Media File Manager...</h2>
          <p>Please wait while the application loads.</p>
          <p style="font-size: 12px; color: #888;">Please wait...</p>
        </div>
      </div>
    </div>
    <style>
      @keyframes spin { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(360deg); } 
      }
    </style>
  </body>
</html>
